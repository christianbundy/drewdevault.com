<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Shell access for builds.sr.ht CI</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://drewdevault.com/blog/index.xml">
  <link rel="icon" type="image/png" href="/avatar.png">
  
  <link rel="stylesheet" href="/main.min.d007a22f956a425cfa3f96c70ba325efd0f789fa65d2e609314f66cbe89ef0de.css">
</head>


<h1>
  Shell access for builds.sr.ht CI
  <small>
    <span class="date">August 19, 2019</span>
    on
    <span class="site"><a href=".">Drew DeVault&#39;s blog</a></span>
  </small>
</h1>

<main>
  <article>
    <p>Have you ever found yourself staring at a failed CI build, wondering desperately
what happened? Or, have you ever needed a fresh machine on-demand to test out an
idea in? Have you been working on Linux, but need to test something on OpenBSD?
Starting this week, builds.sr.ht can help with all of these problems, because
you can now SSH into the build environment.</p>
<small class="text-muted">
  If you didn't know, <a href="https://sourcehut.org">Sourcehut</a> is the 100%
  open/libre software forge for hackers, complete with git and Mercurial
  hosting, CI, mailing lists, and more - with no JavaScript. Try it out!
</small>
<p>The next time your build fails on builds.sr.ht, you&rsquo;ll probably notice the
following message:</p>
<p><img src="https://sr.ht/thL-.png" alt="Screenshot of builds.sr.ht showing a prompt to SSH into the failed buildVM and examine it"></p>
<p>After the build fails, we process everything normally - sending emails,
webhooks, and so on - but keep the VM booted for an additional 10 minutes. If
you do log in during this window, we keep the VM alive until you log out or
until your normal build time limit has elapsed. Once you&rsquo;ve logged in, you get a
shell and can do anything you like, such as examining the build artifacts or
tweaking the source and trying again.</p>
<pre><code>$ ssh -t builds@azusa.runners.sr.ht connect 81809
Connected to build job #81809 (failed):
https://builds.sr.ht/jobs/~sircmpwn/81809
Your VM will be terminated 4 hours from now, or when you log out.

bash-5.0 $
</code></pre><p>You can also connect to any build over SSH by adding <code>shell: true</code> to your build
manifest. When you do, the VM will be kept alive after all of the tasks have
finished (even if it doesn&rsquo;t fail) so you can SSH in. You can also SSH in before
the tasks have finished, and tail the output of the build in your terminal. An
example use case might be getting a fresh Alpine environment to test build your
package on:</p>
<script
  id="asciicast-wnLYZwDuvkbIHwgTdmnqtQpXh"
  src="https://asciinema.org/a/pafXXANiWHY9MOH2yXdVHHJRd.js" async
></script>
<p><noscript><i>This article includes third-party JavaScript content from
asciinema.org, a free- and open-source platform that I trust.</i></noscript></p>
<p>This was accomplished with a simple build manifest:</p>
<pre><code>image: alpine/edge
shell: true
sources:
- https://git.alpinelinux.org/aports
tasks:
- &quot;prep-abuild&quot;: |
    abuild-keygen -an
</code></pre><p>Since build manifests run normally in advance of your shell login, you can do
things like install your preferred editor and dotfiles, pull down your SSH keys
through <a href="https://man.sr.ht/tutorials/builds.sr.ht/using-build-secrets.md">build
secrets</a>, or
anything else you desire to set up a comfortable working environment.</p>
<p>Furthermore, by leveraging the <a href="https://man.sr.ht/builds.sr.ht/api.md">builds.sr.ht
API</a>, you can write scripts which take
advantage of the shell features. Need a NetBSD shell? With a little scripting
you can get something like this working:</p>
<script
  id="asciicast-8etTNE7Ptgmu6hO3cVDlvrAal"
  src="https://asciinema.org/a/pafXXANiWHY9MOH2yXdVHHJRd.js" async
></script>
<p>With experimental multiarch support being rolled out, soon you&rsquo;ll be just a few
keystrokes away from an ARM or PowerPC shell, too.</p>
<p>I want to expand more on SSH access in the future. Stay tuned and <a href="mailto:sir@cmpwn.com">let me
know</a> if you have any cool ideas!</p>

  </article>
</main>

<section class="comment">
  

  <p>
  Have a comment on one of my posts? Start a discussion in my public inbox by
  sending an email to
  <a href="mailto:~sircmpwn/public-inbox@lists.sr.ht">~sircmpwn/public-inbox@lists.sr.ht</a>
  [<a href="https://man.sr.ht/lists.sr.ht/etiquette.md">mailing list etiquette</a>]
</section>

<section class="webring">
  <h2>
    Articles from blogs I read
    <small class="attribution">
      Generated by
      <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
    </small>
  </h2>
  <section class="articles">
    
    <div class="article">
      <h4 class="title">
        <a href="https://emersion.fr/blog/2020/status-update-21/" target="_blank" rel="noopener">Status update, August 2020</a>
      </h4>
      <p class="summary">Hi! Regardless of the intense heat I’ve been exposed to this last month,
I’ve still been able to get some stuff done (although having to move out to
another room which isn’t right under the roof).
I’ve worked a lot on IRC-related projects. I’ve added a znc-i…</p>
      <small class="source">
        via <a href="https://emersion.fr/blog/">emersion</a>
      </small>
      <small class="date">2020-08-19 00:00:00 &#43;0200 &#43;0200</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://sourcehut.org/blog/2020-08-16-whats-cooking-august-2020/" target="_blank" rel="noopener">What&#39;s cooking on Sourcehut? August 2020</a>
      </h4>
      <p class="summary">Another month passes and we find ourselves writing (or reading) this status
update on a quiet, rainy Sunday morning. Today our userbase numbers 16,683
members strong, up 580 from last month. Please extend a kind welcome to our new
colleagues! Thanks for read…</p>
      <small class="source">
        via <a href="https://sourcehut.org/blog/">Blogs on Sourcehut</a>
      </small>
      <small class="date">2020-08-16 00:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://blog.golang.org/go1.15" target="_blank" rel="noopener">Go 1.15 is released</a>
      </h4>
      <p class="summary">
  
  
    
      
        Today the Go team is very happy to announce the release of Go 1.15. You can get it from the download page.
Some of the highlights include:

Substantial improvements to the Go linker
Improved allocation for small objects at high core coun…</p>
      <small class="source">
        via <a href="https://blog.golang.org/feed.atom">The Go Programming Language Blog</a>
      </small>
      <small class="date">2020-08-11 11:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://100r.co/site/north_pacific_logbook.html" target="_blank" rel="noopener">North Pacific Logbook</a>
      </h4>
      <p class="summary">
The passage from Japan (Shimoda) to Canada (Victoria) took 51 days, and it was the hardest thing we&#39;ve ever done. We decided to keep a logbook, to better remember it and so it can help others who wish to make this trip.Continue Reading
  </p>
      <small class="source">
        via <a href="https://100r.co/">Hundred Rabbits</a>
      </small>
      <small class="date">2020-07-31 00:00:00 &#43;0000 GMT</small>
    </div>
    
  </section>
</section>


<footer>
  The content for this site is
  <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
  The <a href="https://git.sr.ht/~sircmpwn/drewdevault.com">code for this site</a>
  is <a href="https://opensource.org/licenses/MIT">MIT</a>.
</footer>

