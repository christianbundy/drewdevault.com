<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Using Cage for a seamless remote Wayland session</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://drewdevault.com/blog/index.xml">
  <link rel="icon" type="image/png" href="/avatar.png">
  
  <link rel="stylesheet" href="/main.min.d007a22f956a425cfa3f96c70ba325efd0f789fa65d2e609314f66cbe89ef0de.css">
</head>


<h1>
  Using Cage for a seamless remote Wayland session
  <small>
    <span class="date">April 23, 2019</span>
    on
    <span class="site"><a href=".">Drew DeVault&#39;s blog</a></span>
  </small>
</h1>

<main>
  <article>
    <p>Congratulations to Jente Hidskes on <a href="https://www.hjdskes.nl/blog/cage-01/">the first release of
Cage</a>! Cage is a Wayland compositor
designed for kiosks - though, as you&rsquo;ll shortly find out, is useful in many
unexpected ways. It launches a single application, in fullscreen, and exits the
compositor when that application exits. This lets you basically add a
DRM+KMS+libinput session to any Wayland-compatible application (or X application
via XWayland) and run it in a tiny wlroots compositor.</p>
<p>I actually was planning on writing something like this at some point (for a
project which still hasn&rsquo;t really come off the ground yet), so I was excited
when Jente <a href="https://www.hjdskes.nl/blog/cage/">announced it</a> in December. With
the addition of the <a href="https://github.com/swaywm/wlroots/pull/1578">RDP backend</a>
in wlroots, I thought it would be cool to combine these to make a seamless
remote desktop experience. In short, I installed
<a href="http://www.freerdp.com/">FreeRDP</a> and Cage on my laptop, and
<a href="https://swaywm.org">sway</a> on my desktop. On my desktop, I <a href="https://github.com/swaywm/wlroots/blob/master/docs/env_vars.md#rdp-backend">generated TLS
certificates per the wlroots
docs</a>
and ran sway like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">WLR_RDP_TLS_CERT_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/tls.crt <span class="se">\
</span><span class="se"></span><span class="nv">WLR_RDP_TLS_KEY_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/tls.key <span class="se">\
</span><span class="se"></span><span class="nv">WLR_BACKENDS</span><span class="o">=</span>rdp <span class="se">\
</span><span class="se"></span>sway
</code></pre></div><p>Then, on my laptop, I can run this script:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/sh
</span><span class="cp"></span><span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> -eq <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
	<span class="nb">export</span> <span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span>/tmp
	<span class="nb">exec</span> cage sway-remote launch
<span class="k">else</span>
	sleep <span class="m">3</span>
	<span class="nb">exec</span> xfreerdp <span class="se">\
</span><span class="se"></span>		-v homura <span class="se">\
</span><span class="se"></span>		--bpp <span class="m">32</span> <span class="se">\
</span><span class="se"></span>		--size 1280x800 <span class="se">\
</span><span class="se"></span>		--rfx
<span class="k">fi</span>
</code></pre></div><p>The first branch is taken on the first run, and it starts up cage and asks it to
run this script again. The second branch then starts up xfreerdp and connects to
my desktop (its hostname is <code>homura</code>). xfreerdp is then fullscreened and all of
my laptop&rsquo;s input events are directed to it. The result is an experience which
is basically identical to running sway directly on my laptop, except it&rsquo;s
actually running on my desktop and using the remote desktop protocol to send
everything back and forth.</p>
<p>This isn&rsquo;t especially practical, but it is a cool hack. It&rsquo;s definitely not
network transparency like some people want, but I wasn&rsquo;t aiming for that. It&rsquo;s
just a neat thing you can do now that we have an RDP backend for wlroots. And
congrats again to Jente - be sure to give Cage a look and see if you can think
of any other novel use-cases, too!</p>

  </article>
</main>

<section class="comment">
  

  <p>
  Have a comment on one of my posts? Start a discussion in my public inbox by
  sending an email to
  <a href="mailto:~sircmpwn/public-inbox@lists.sr.ht">~sircmpwn/public-inbox@lists.sr.ht</a>
  [<a href="https://man.sr.ht/lists.sr.ht/etiquette.md">mailing list etiquette</a>]
</section>

<section class="webring">
  <h2>
    Articles from blogs I read
    <small class="attribution">
      Generated by
      <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
    </small>
  </h2>
  <section class="articles">
    
    <div class="article">
      <h4 class="title">
        <a href="https://emersion.fr/blog/2020/status-update-21/" target="_blank" rel="noopener">Status update, August 2020</a>
      </h4>
      <p class="summary">Hi! Regardless of the intense heat I’ve been exposed to this last month,
I’ve still been able to get some stuff done (although having to move out to
another room which isn’t right under the roof).
I’ve worked a lot on IRC-related projects. I’ve added a znc-i…</p>
      <small class="source">
        via <a href="https://emersion.fr/blog/">emersion</a>
      </small>
      <small class="date">2020-08-19 00:00:00 &#43;0200 &#43;0200</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://sourcehut.org/blog/2020-08-16-whats-cooking-august-2020/" target="_blank" rel="noopener">What&#39;s cooking on Sourcehut? August 2020</a>
      </h4>
      <p class="summary">Another month passes and we find ourselves writing (or reading) this status
update on a quiet, rainy Sunday morning. Today our userbase numbers 16,683
members strong, up 580 from last month. Please extend a kind welcome to our new
colleagues! Thanks for read…</p>
      <small class="source">
        via <a href="https://sourcehut.org/blog/">Blogs on Sourcehut</a>
      </small>
      <small class="date">2020-08-16 00:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://blog.golang.org/go1.15" target="_blank" rel="noopener">Go 1.15 is released</a>
      </h4>
      <p class="summary">
  
  
    
      
        Today the Go team is very happy to announce the release of Go 1.15. You can get it from the download page.
Some of the highlights include:

Substantial improvements to the Go linker
Improved allocation for small objects at high core coun…</p>
      <small class="source">
        via <a href="https://blog.golang.org/feed.atom">The Go Programming Language Blog</a>
      </small>
      <small class="date">2020-08-11 11:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://100r.co/site/north_pacific_logbook.html" target="_blank" rel="noopener">North Pacific Logbook</a>
      </h4>
      <p class="summary">
The passage from Japan (Shimoda) to Canada (Victoria) took 51 days, and it was the hardest thing we&#39;ve ever done. We decided to keep a logbook, to better remember it and so it can help others who wish to make this trip.Continue Reading
  </p>
      <small class="source">
        via <a href="https://100r.co/">Hundred Rabbits</a>
      </small>
      <small class="date">2020-07-31 00:00:00 &#43;0000 GMT</small>
    </div>
    
  </section>
</section>


<footer>
  The content for this site is
  <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
  The <a href="https://git.sr.ht/~sircmpwn/drewdevault.com">code for this site</a>
  is <a href="https://opensource.org/licenses/MIT">MIT</a>.
</footer>

