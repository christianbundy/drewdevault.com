<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Status update, November 2020</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://drewdevault.com/blog/index.xml">
  <link rel="icon" type="image/png" href="/avatar.png">
  
  <link rel="stylesheet" href="/main.min.d007a22f956a425cfa3f96c70ba325efd0f789fa65d2e609314f66cbe89ef0de.css">
</head>


<h1>
  Status update, November 2020
  <small>
    <span class="date">November 15, 2020</span>
    on
    <span class="site"><a href=".">Drew DeVault&#39;s blog</a></span>
  </small>
</h1>

<main>
  <article>
    <p>Greetings, humanoids! Our fleshy vessels have aged by 2.678×10⁶ seconds, and you
know what that means: time for another status update! Pour a cup of your
favorite beverage stimulant and gather &lsquo;round for some news.</p>
<p>First off, today is the second anniversary of SourceHut&rsquo;s alpha being opened to
the public, and as such, I&rsquo;ve prepared a special <a href="https://sourcehut.org/blog/2020-11-15-sourcehut-2-year-alpha/">blog post</a> for
you to read. I&rsquo;ll leave the sr.ht details out of this post and just send you off
to read about it there.</p>
<p>What else is new? Well, a few things. For one, I&rsquo;ve been working more on Gemini.
I added CGI support to <a href="https://sr.ht/~sircmpwn/gmnisrv">gmnisrv</a> and wrote a
few <a href="https://git.sr.ht/~sircmpwn/cgi-scripts">CGI scripts</a> to do neato Gemini
things with. I&rsquo;ve also added regexp routing and URL rewriting support. We can
probably ship gmnisrv 1.0 as soon as the last few bugs are flushed out, and a
couple of minor features are added, and we might switch to another SSL
implementation as well. Thanks to the many contributors who&rsquo;ve helped out:
William Casarin, Tom Lebreux, Kenny Levinsen, Eyal Sawady, René Wagner,
dbandstra, and mbays.</p>
<p>In <a href="https://baremessages.org">BARE</a> news: Elm, Erlang, Java, and Ruby
implementations have appeared, and I have submitted a
<a href="https://datatracker.ietf.org/doc/draft-devault-bare/">draft RFC</a> to the IETF
for standardization.</p>
<p>Finally, I wrote a new Wayland server for you. Its only dependencies are a POSIX
system and a C11 compiler — and it works with Nvidia GPUs, or even systems
without OpenGL support at all. Here&rsquo;s the code:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;poll.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/un.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
	<span class="k">typedef</span> <span class="n">int16_t</span> <span class="n">i16</span><span class="p">;</span> <span class="k">typedef</span> <span class="n">int32_t</span> <span class="n">i32</span><span class="p">;</span> <span class="k">typedef</span> <span class="n">uint16_t</span> <span class="n">u16</span><span class="p">;</span>
   <span class="k">typedef</span> <span class="n">uint32_t</span> <span class="n">u32</span><span class="p">;</span> <span class="k">typedef</span> <span class="n">uint8_t</span> <span class="n">u8</span><span class="p">;</span> <span class="k">typedef</span> <span class="kt">int</span> <span class="n">I</span><span class="p">;</span> <span class="k">typedef</span> <span class="n">size_t</span> <span class="n">S</span><span class="p">;</span>
	  <span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span><span class="kt">int</span> <span class="n">b</span><span class="p">;</span><span class="n">u32</span> <span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">;</span><span class="kt">char</span><span class="o">*</span><span class="n">e</span><span class="p">;</span><span class="n">i32</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">fmt</span><span class="p">;}</span><span class="n">O</span><span class="p">;</span>
	       <span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span><span class="kt">char</span><span class="o">*</span><span class="n">a</span><span class="p">;</span><span class="n">u32</span> <span class="n">b</span><span class="p">;</span><span class="n">I</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">)(</span><span class="n">I</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">u32</span><span class="p">,</span><span class="n">u16</span><span class="p">);}</span><span class="n">G</span><span class="p">;</span>

	  <span class="k">struct</span> <span class="n">pollfd</span> <span class="n">fds</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span><span class="kt">char</span> <span class="n">a</span><span class="p">[</span><span class="mh">0xFFFF</span><span class="p">];</span><span class="n">I</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span><span class="n">u32</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			      <span class="n">O</span> <span class="n">f</span><span class="p">[</span><span class="mi">128</span><span class="p">][</span><span class="mi">128</span><span class="p">];</span><span class="n">G</span> <span class="n">g</span><span class="p">[];</span>

<span class="cp">#define AR I z,I y,u32 x,u16 c
</span><span class="cp">#define SN(n) (((n)%4)==0?(n):(n)+(4-((n)%4)))
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">u8w</span><span class="p">(</span><span class="n">FILE</span><span class="o">*</span><span class="n">f</span><span class="p">,</span><span class="n">u32</span> <span class="n">ch</span><span class="p">){</span><span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="k">for</span> <span class="p">(</span><span class="n">I</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="o">--</span><span class="n">i</span><span class="p">){</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">ch</span><span class="o">&amp;</span><span class="mh">0x3f</span><span class="p">)</span><span class="o">|</span><span class="mh">0x80</span><span class="p">;</span><span class="n">ch</span><span class="o">&gt;&gt;=</span><span class="mi">6</span>
<span class="p">;}</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="o">|</span><span class="mh">0xE0</span><span class="p">;</span><span class="n">fwrite</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">f</span><span class="p">);}</span><span class="kt">void</span> <span class="nf">xrgb</span><span class="p">(</span><span class="n">u32</span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="n">i32</span> <span class="n">w</span><span class="p">,</span><span class="n">i32</span> <span class="n">h</span><span class="p">,</span><span class="n">i32</span> <span class="n">s</span><span class="p">){</span><span class="k">struct</span>
<span class="n">winsize</span> <span class="n">sz</span><span class="p">;</span><span class="n">ioctl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">TIOCGWINSZ</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sz</span><span class="p">);</span><span class="o">--</span><span class="n">sz</span><span class="p">.</span><span class="n">ws_row</span><span class="p">;</span><span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x1b</span><span class="s">[H</span><span class="se">\x1b</span><span class="s">[2J</span><span class="se">\x1b</span><span class="s">[3J&#34;</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="n">I</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">y</span><span class="o">&lt;</span><span class="n">sz</span><span class="p">.</span><span class="n">ws_row</span><span class="p">;</span><span class="o">++</span><span class="n">y</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="n">I</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;</span><span class="n">sz</span><span class="p">.</span><span class="n">ws_col</span><span class="p">;</span><span class="o">++</span><span class="n">x</span><span class="p">){</span><span class="n">I</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">u32</span> <span class="n">c</span> <span class="o">=</span> <span class="mh">0x2800</span><span class="p">;</span><span class="k">const</span>
<span class="n">I</span> <span class="n">f</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">};</span><span class="k">for</span><span class="p">(</span><span class="n">I</span> <span class="n">my</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">my</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="o">++</span><span class="n">my</span><span class="p">)</span><span class="k">for</span><span class="p">(</span><span class="n">I</span> <span class="n">mx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">mx</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="o">++</span><span class="n">mx</span><span class="p">){</span><span class="n">u32</span> <span class="n">p</span><span class="o">=</span><span class="n">data</span><span class="p">[((</span>
<span class="n">y</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">my</span><span class="p">)</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">ws_row</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">mx</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">ws_col</span><span class="o">*</span><span class="mi">2</span><span class="p">)];</span><span class="n">u8</span> <span class="n">avg</span><span class="o">=</span><span class="p">((</span><span class="n">p</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">p</span>
<span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">p</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="n">avg</span><span class="o">&gt;</span><span class="mh">0x80</span><span class="p">)</span><span class="n">c</span><span class="o">|=</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];}</span><span class="n">u8w</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">c</span><span class="p">);}</span><span class="n">putchar</span><span class="p">(</span>
<span class="sc">&#39;\n&#39;</span><span class="p">);}</span><span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);}</span><span class="n">O</span><span class="o">*</span><span class="nf">ao</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">,</span><span class="n">u32</span> <span class="n">y</span><span class="p">,</span><span class="n">I</span> <span class="n">x</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="n">S</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
<span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="o">=</span><span class="n">y</span><span class="p">;</span><span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="k">return</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">];}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="n">O</span><span class="o">*</span><span class="nf">go</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">,</span><span class="n">u32</span> <span class="n">y</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="n">S</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span>
<span class="mi">128</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="o">==</span><span class="n">y</span><span class="p">)</span><span class="k">return</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">i</span><span class="p">];</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="kt">void</span> <span class="nf">wh</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">,</span><span class="n">i32</span> <span class="n">y</span><span class="p">,</span><span class="n">i16</span> <span class="n">x</span><span class="p">,</span> <span class="n">i16</span> <span class="n">w</span>
<span class="p">){</span><span class="n">write</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">i32</span> <span class="n">u</span><span class="o">=</span><span class="p">((</span><span class="n">w</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span><span class="o">|</span><span class="n">x</span><span class="p">;</span><span class="n">write</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">);}</span><span class="kt">void</span> <span class="nf">ws</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span><span class="n">y</span><span class="p">){</span><span class="n">i32</span> <span class="n">l</span><span class="o">=</span>
<span class="n">strlen</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">write</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">l</span><span class="o">=</span><span class="n">SN</span><span class="p">(</span><span class="n">l</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">l</span><span class="p">);}</span><span class="n">I</span> <span class="nf">rs</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">){</span><span class="n">u32</span> <span class="n">l</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="o">&amp;</span><span class="n">l</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">l</span><span class="o">=</span>
<span class="n">SN</span><span class="p">(</span><span class="n">l</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">l</span><span class="p">);</span><span class="k">return</span> <span class="n">l</span><span class="o">+</span><span class="mi">4</span><span class="p">;}</span><span class="n">I</span> <span class="nf">ga</span><span class="p">(</span><span class="n">I</span> <span class="n">z</span><span class="p">,</span><span class="n">I</span> <span class="n">y</span><span class="p">,</span><span class="n">u32</span> <span class="n">x</span><span class="p">,</span><span class="n">u16</span> <span class="n">w</span><span class="p">){</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span>
<span class="mi">4</span><span class="p">);</span><span class="n">I</span> <span class="n">sz</span><span class="o">=</span><span class="n">rs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="o">--</span><span class="n">u</span><span class="p">;</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">u</span><span class="p">);</span><span class="k">switch</span><span class="p">(</span><span class="n">u</span><span class="p">){</span><span class="k">case</span> <span class="mi">1</span><span class="o">:++</span><span class="n">s</span><span class="p">;</span><span class="n">wh</span>
<span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="o">--</span><span class="n">s</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="mi">6</span><span class="o">:</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="k">return</span> <span class="n">sz</span><span class="p">;}</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span>
<span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">return</span> <span class="n">sz</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gb</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">u32</span> <span class="n">w</span><span class="p">,</span><span class="n">u</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">I</span> <span class="n">t</span><span class="o">=</span><span class="n">d</span><span class="p">;</span><span class="n">d</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">O</span> <span class="o">*</span><span class="n">o</span><span class="o">=</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">e</span><span class="o">=</span><span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">PROT_READ</span><span class="p">,</span><span class="n">MAP_PRIVATE</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">return</span> <span class="mi">8</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gc</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">u32</span>
<span class="n">w</span><span class="p">;</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">8</span><span class="o">+</span><span class="n">c</span><span class="p">);</span><span class="k">return</span> <span class="mi">4</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gd</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">O</span><span class="o">*</span><span class="n">o</span><span class="p">,</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="o">*</span><span class="n">t</span><span class="p">;</span><span class="n">i32</span> <span class="n">u</span><span class="p">,</span><span class="n">w</span><span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span><span class="k">case</span> <span class="mi">1</span>
<span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">d</span><span class="o">=</span><span class="n">u</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">u</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span><span class="n">O</span> <span class="o">*</span><span class="n">b</span><span class="o">=</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">u</span><span class="p">);</span><span class="n">xrgb</span>
<span class="p">((</span><span class="n">u32</span><span class="o">*</span><span class="p">)</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">e</span><span class="p">,</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">,</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">s</span><span class="p">);}</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">return</span> <span class="mi">12</span><span class="p">;</span><span class="k">case</span> <span class="mi">2</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="n">u</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span><span class="k">return</span> <span class="mi">16</span><span class="p">;</span><span class="k">case</span> <span class="mi">3</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">struct</span> <span class="n">timespec</span>
<span class="n">ts</span><span class="o">=</span><span class="p">{.</span><span class="n">tv_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,.</span><span class="n">tv_nsec</span><span class="o">=</span><span class="mf">1.6e6</span><span class="p">};</span><span class="n">nanosleep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ts</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">return</span>
<span class="mi">4</span><span class="p">;</span><span class="k">case</span> <span class="mi">6</span><span class="o">:</span><span class="n">o</span><span class="o">=</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="n">r</span><span class="o">=</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">&amp;&amp;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">b</span><span class="o">==</span><span class="mi">12</span><span class="p">){</span><span class="n">t</span><span class="o">=</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">b</span><span class="o">==</span><span class="mi">13</span><span class="p">){</span><span class="n">u32</span>
<span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);}</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">e</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="o">++</span><span class="n">e</span><span class="p">;}</span><span class="k">break</span><span class="p">;}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="n">I</span> <span class="nf">ge</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">u32</span> <span class="n">w</span><span class="p">,</span><span class="n">u</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span>
<span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">O</span><span class="o">*</span><span class="n">o</span><span class="o">=</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">d</span><span class="o">=</span><span class="n">u</span><span class="p">;</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">u</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">c</span><span class="o">=</span><span class="n">w</span><span class="p">;</span><span class="k">return</span> <span class="mi">8</span><span class="p">;}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gf</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">u32</span> <span class="n">w</span><span class="p">,</span><span class="n">ae</span>
<span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span><span class="k">case</span> <span class="mi">1</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">O</span><span class="o">*</span><span class="n">obj</span><span class="o">=</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">d</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">c</span><span class="o">=</span><span class="n">w</span><span class="p">;</span><span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">case</span> <span class="mi">4</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ae</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">return</span> <span class="mi">4</span><span class="p">;}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gg</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">I</span> <span class="n">sz</span><span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span><span class="k">case</span> <span class="mi">2</span><span class="o">:</span><span class="n">sz</span><span class="o">=</span><span class="n">rs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="p">;</span><span class="k">return</span> <span class="n">sz</span><span class="p">;}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span><span class="n">I</span> <span class="nf">gh</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">i32</span> <span class="n">w</span><span class="p">,</span><span class="n">u</span><span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span><span class="k">case</span> <span class="mi">0</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span><span class="mi">4</span>
<span class="p">);</span><span class="n">O</span><span class="o">*</span><span class="n">b</span><span class="o">=</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">e</span><span class="o">=&amp;</span><span class="n">go</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">e</span><span class="p">[</span><span class="n">u</span><span class="p">];</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span>
                  <span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">fmt</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">return</span> <span class="mi">24</span><span class="p">;}</span><span class="k">return</span> <span class="mi">0</span><span class="p">;}</span>

<span class="n">G</span> <span class="n">g</span><span class="p">[]</span><span class="o">=</span><span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ga</span><span class="p">},{</span><span class="s">&#34;wl_shm&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">gb</span><span class="p">},{</span><span class="s">&#34;wl_compositor&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">gc</span><span class="p">},{</span><span class="s">&#34;wl_subcompositor&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span>
<span class="p">{</span><span class="s">&#34;wl_data_device_manager&#34;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="s">&#34;wl_output&#34;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="s">&#34;wl_seat&#34;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="s">&#34;xdg_wm_base&#34;</span><span class="p">,</span>
<span class="mi">2</span><span class="p">,</span><span class="n">ge</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">gd</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">gf</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">gg</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">gh</span><span class="p">}};</span>

<span class="kt">void</span> <span class="nf">gi</span><span class="p">(</span><span class="n">AR</span><span class="p">){</span><span class="n">u32</span> <span class="n">w</span><span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span><span class="k">case</span> <span class="mi">0</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="mi">1</span><span class="o">:</span><span class="n">read</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">w</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">ao</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="n">S</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]);){</span><span class="n">G</span><span class="o">*</span><span class="n">z</span><span class="o">=&amp;</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">z</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span><span class="n">I</span> <span class="n">gl</span><span class="o">=</span><span class="n">strlen</span><span class="p">(</span><span class="n">z</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">wh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">+</span><span class="n">SN</span><span class="p">(</span><span class="n">gl</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span><span class="n">ws</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                <span class="n">z</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">);</span><span class="n">write</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">z</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">,</span><span class="mi">4</span><span class="p">);}</span><span class="k">break</span><span class="p">;}}</span><span class="kt">void</span> <span class="nf">si</span><span class="p">(){</span><span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span>

<span class="n">I</span> <span class="nf">main</span><span class="p">(</span><span class="n">I</span> <span class="n">_1</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span><span class="n">_2</span><span class="p">){</span><span class="n">I</span> <span class="n">z</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_UNIX</span><span class="p">,</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">struct</span> <span class="n">sockaddr_un</span> <span class="n">y</span><span class="o">=</span><span class="p">{.</span>
<span class="n">sun_family</span><span class="o">=</span><span class="n">AF_UNIX</span><span class="p">};</span><span class="kt">char</span> <span class="o">*</span><span class="n">x</span><span class="o">=</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#34;XDG_RUNTIME_DIR&#34;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="o">=</span><span class="s">&#34;/tmp&#34;</span><span class="p">;</span><span class="k">do</span><span class="p">{</span><span class="n">sprintf</span><span class="p">(</span>
 <span class="n">y</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span><span class="s">&#34;%s/wayland-%d&#34;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">c</span><span class="o">++</span><span class="p">);}</span><span class="k">while</span><span class="p">(</span><span class="n">access</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span><span class="n">F_OK</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">);</span><span class="n">bind</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="p">(</span>
<span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">y</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">y</span><span class="p">));</span><span class="n">listen</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="n">S</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fds</span><span class="p">);</span><span class="o">++</span><span class="n">i</span><span class="p">){</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span>
<span class="n">events</span><span class="o">=</span><span class="n">POLLIN</span><span class="o">|</span><span class="n">POLLHUP</span><span class="p">;</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">revents</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fd</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span><span class="n">fds</span><span class="p">[</span><span class="n">b</span><span class="o">++</span><span class="p">].</span><span class="n">fd</span><span class="o">=</span><span class="n">z</span><span class="p">;</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span>
<span class="n">si</span><span class="p">);</span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span><span class="k">while</span><span class="p">(</span><span class="n">poll</span><span class="p">(</span><span class="n">fds</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">!=-</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="n">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">revents</span><span class="p">){</span><span class="n">I</span> <span class="n">u</span><span class="o">=</span>
<span class="n">accept</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="n">fds</span><span class="p">[</span><span class="n">b</span><span class="o">++</span><span class="p">].</span><span class="n">fd</span><span class="o">=</span><span class="n">u</span><span class="p">;}</span><span class="k">for</span><span class="p">(</span><span class="n">I</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">b</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">revents</span><span class="o">&amp;</span><span class="n">POLLHUP</span><span class="p">){</span>
<span class="n">memmove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">&amp;</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">32</span><span class="o">-</span><span class="n">i</span><span class="p">);</span><span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">));</span><span class="o">--</span><span class="n">b</span><span class="p">;</span><span class="k">continue</span><span class="p">;}</span>
<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">revents</span><span class="p">){</span><span class="k">continue</span><span class="p">;}</span><span class="n">I</span> <span class="n">u</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">I</span> <span class="n">t</span><span class="o">=</span><span class="n">fds</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fd</span><span class="p">;</span><span class="n">u32</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">;</span><span class="kt">char</span> <span class="n">q</span><span class="p">[</span>
<span class="n">CMSG_SPACE</span><span class="p">(</span><span class="mi">8</span><span class="p">)];</span><span class="k">struct</span> <span class="n">cmsghdr</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="k">struct</span> <span class="n">iovec</span> <span class="n">n</span><span class="o">=</span><span class="p">{.</span><span class="n">iov_base</span><span class="o">=&amp;</span><span class="n">s</span><span class="p">,.</span><span class="n">iov_len</span><span class="o">=</span><span class="mi">4</span><span class="p">};</span><span class="k">struct</span>
<span class="n">msghdr</span> <span class="n">m</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span><span class="n">m</span><span class="p">.</span><span class="n">msg_iov</span><span class="o">=&amp;</span><span class="n">n</span><span class="p">;</span><span class="n">m</span><span class="p">.</span><span class="n">msg_iovlen</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">m</span><span class="p">.</span><span class="n">msg_control</span><span class="o">=</span><span class="n">q</span><span class="p">;</span><span class="n">m</span><span class="p">.</span><span class="n">msg_controllen</span><span class="o">=</span><span class="k">sizeof</span>
<span class="p">(</span><span class="n">q</span><span class="p">);</span><span class="n">recvmsg</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="n">p</span><span class="o">=</span><span class="n">CMSG_FIRSTHDR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">){</span><span class="n">d</span><span class="o">=*</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span><span class="p">)</span><span class="n">CMSG_DATA</span><span class="p">(</span><span class="n">p</span><span class="p">);}</span><span class="n">read</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="o">&amp;</span><span class="n">r</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="p">;</span><span class="n">u16</span> <span class="n">o</span><span class="o">=</span><span class="p">((</span><span class="n">r</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">r</span><span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span><span class="n">gi</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">);}</span><span class="k">else</span><span class="p">{</span><span class="k">for</span><span class="p">(</span><span class="n">S</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">;</span>
<span class="o">++</span><span class="n">j</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">a</span><span class="o">==</span><span class="n">s</span><span class="o">&amp;&amp;</span><span class="n">g</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">b</span><span class="p">].</span><span class="n">c</span><span class="p">){</span><span class="n">o</span><span class="o">-=</span><span class="n">g</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">b</span><span class="p">].</span><span class="n">c</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="k">break</span><span class="p">;}}</span><span class="k">if</span><span class="p">(</span><span class="n">o</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
                     <span class="p">{</span><span class="n">read</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">o</span><span class="p">);}}}}</span><span class="n">unlink</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">sun_path</span><span class="p">);}</span>
</code></pre></div><p>You&rsquo;re welcome!</p>

  </article>
</main>

<section class="comment">
  
  <p>
  ⇒ This article is also available <a href="gemini://./2020/11/15/Status-update-November-2020.gmi">on gemini</a>.
  

  <p>
  Have a comment on one of my posts? Start a discussion in my public inbox by
  sending an email to
  <a href="mailto:~sircmpwn/public-inbox@lists.sr.ht">~sircmpwn/public-inbox@lists.sr.ht</a>
  [<a href="https://man.sr.ht/lists.sr.ht/etiquette.md">mailing list etiquette</a>]
</section>

<section class="webring">
  <h2>
    Articles from blogs I read
    <small class="attribution">
      Generated by
      <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
    </small>
  </h2>
  <section class="articles">
    
    <div class="article">
      <h4 class="title">
        <a href="https://emersion.fr/blog/2020/status-update-21/" target="_blank" rel="noopener">Status update, August 2020</a>
      </h4>
      <p class="summary">Hi! Regardless of the intense heat I’ve been exposed to this last month,
I’ve still been able to get some stuff done (although having to move out to
another room which isn’t right under the roof).
I’ve worked a lot on IRC-related projects. I’ve added a znc-i…</p>
      <small class="source">
        via <a href="https://emersion.fr/blog/">emersion</a>
      </small>
      <small class="date">2020-08-19 00:00:00 &#43;0200 &#43;0200</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://sourcehut.org/blog/2020-08-16-whats-cooking-august-2020/" target="_blank" rel="noopener">What&#39;s cooking on Sourcehut? August 2020</a>
      </h4>
      <p class="summary">Another month passes and we find ourselves writing (or reading) this status
update on a quiet, rainy Sunday morning. Today our userbase numbers 16,683
members strong, up 580 from last month. Please extend a kind welcome to our new
colleagues! Thanks for read…</p>
      <small class="source">
        via <a href="https://sourcehut.org/blog/">Blogs on Sourcehut</a>
      </small>
      <small class="date">2020-08-16 00:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://blog.golang.org/go1.15" target="_blank" rel="noopener">Go 1.15 is released</a>
      </h4>
      <p class="summary">
  
  
    
      
        Today the Go team is very happy to announce the release of Go 1.15. You can get it from the download page.
Some of the highlights include:

Substantial improvements to the Go linker
Improved allocation for small objects at high core coun…</p>
      <small class="source">
        via <a href="https://blog.golang.org/feed.atom">The Go Programming Language Blog</a>
      </small>
      <small class="date">2020-08-11 11:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://100r.co/site/north_pacific_logbook.html" target="_blank" rel="noopener">North Pacific Logbook</a>
      </h4>
      <p class="summary">
The passage from Japan (Shimoda) to Canada (Victoria) took 51 days, and it was the hardest thing we&#39;ve ever done. We decided to keep a logbook, to better remember it and so it can help others who wish to make this trip.Continue Reading
  </p>
      <small class="source">
        via <a href="https://100r.co/">Hundred Rabbits</a>
      </small>
      <small class="date">2020-07-31 00:00:00 &#43;0000 GMT</small>
    </div>
    
  </section>
</section>


<footer>
  The content for this site is
  <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
  The <a href="https://git.sr.ht/~sircmpwn/drewdevault.com">code for this site</a>
  is <a href="https://opensource.org/licenses/MIT">MIT</a>.
</footer>

