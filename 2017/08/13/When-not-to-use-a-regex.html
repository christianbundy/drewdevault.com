<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>When not to use a regex</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://drewdevault.com/blog/index.xml">
  <link rel="icon" type="image/png" href="/avatar.png">
  
  <link rel="stylesheet" href="/main.min.d007a22f956a425cfa3f96c70ba325efd0f789fa65d2e609314f66cbe89ef0de.css">
</head>


<h1>
  When not to use a regex
  <small>
    <span class="date">August 13, 2017</span>
    on
    <span class="site"><a href=".">Drew DeVault&#39;s blog</a></span>
  </small>
</h1>

<main>
  <article>
    <p>The other day, I saw <a href="https://github.com/zeeshanu/learn-regex">Learn regex the easy
way</a>. This is a great resource, but I
felt the need to pen a post explaining that regexes are usually not the right
approach.</p>
<p>Let&rsquo;s do a little exercise. I googled &ldquo;URL regex&rdquo; and here&rsquo;s the first Stack
Overflow result:</p>
<pre><code>https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&amp;//=]*)
</code></pre><p style="text-align: right">
<small><a href="https://stackoverflow.com/a/3809435/1191610">source</a></small>
</p>
<p>This is a bad regex. Here are some valid URLs that this regex fails to match:</p>
<ul>
<li>http://x.org</li>
<li><a href="http://nic.science">http://nic.science</a></li>
<li>http://名がドメイン.com (warning: this is a parked domain)</li>
<li><a href="http://example.org/url,with,commas">http://example.org/url,with,commas</a></li>
<li><a href="https://en.wikipedia.org/wiki/Harry_Potter_(film_series)">https://en.wikipedia.org/wiki/Harry_Potter_(film_series)</a></li>
<li>http://127.0.0.1</li>
<li>http://[::1] (ipv6 loopback)</li>
</ul>
<p>Here are some invalid URLs the regex is fine with:</p>
<ul>
<li><a href="http://exam..ple.org">http://exam..ple.org</a></li>
<li><a href="http://--example.org">http://--example.org</a></li>
</ul>
<p>This answer has been revised 9 times on Stack Overflow, and this is the best
they could come up with. Go back and read the regex. Can you tell where each of
these bugs are? How long did it take you? If you received a bug report in your
application because one of these URLs was handled incorrectly, do you understand
this regex well enough to fix it? If your application has a URL regex, go find
it and see how it fares with these tests.</p>
<p>Complicated regexes are opaque, unmaintainable, and often wrong. The correct
approach to validating a URL is as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="k">def</span> <span class="nf">is_url_valid</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div><p>A regex is useful for validating <em>simple</em> patterns and for <em>finding</em> patterns in
text. For anything beyond that it&rsquo;s almost certainly a terrible choice. Say you
want to&hellip;</p>
<p><strong>validate an email address</strong>: try to send an email to it!</p>
<p><strong>validate password strength requirements</strong>: estimate the complexity with
<a href="https://github.com/dropbox/zxcvbn">zxcvbn</a>!</p>
<p><strong>validate a date</strong>: use your standard library!
<a href="https://docs.python.org/3.6/library/datetime.html#datetime.datetime.strptime">datetime.datetime.strptime</a></p>
<p><strong>validate a credit card number</strong>: run the <a href="https://en.wikipedia.org/wiki/Luhn_algorithm">Luhn
algorithm</a> on it!</p>
<p><strong>validate a social security number</strong>: alright, use a regex. But don&rsquo;t expect
the number to be assigned to someone until you ask the Social Security
Administration about it!</p>
<p>Get the picture?</p>

  </article>
</main>

<section class="comment">
  

  <p>
  Have a comment on one of my posts? Start a discussion in my public inbox by
  sending an email to
  <a href="mailto:~sircmpwn/public-inbox@lists.sr.ht">~sircmpwn/public-inbox@lists.sr.ht</a>
  [<a href="https://man.sr.ht/lists.sr.ht/etiquette.md">mailing list etiquette</a>]
</section>

<section class="webring">
  <h2>
    Articles from blogs I read
    <small class="attribution">
      Generated by
      <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
    </small>
  </h2>
  <section class="articles">
    
    <div class="article">
      <h4 class="title">
        <a href="https://emersion.fr/blog/2020/status-update-21/" target="_blank" rel="noopener">Status update, August 2020</a>
      </h4>
      <p class="summary">Hi! Regardless of the intense heat I’ve been exposed to this last month,
I’ve still been able to get some stuff done (although having to move out to
another room which isn’t right under the roof).
I’ve worked a lot on IRC-related projects. I’ve added a znc-i…</p>
      <small class="source">
        via <a href="https://emersion.fr/blog/">emersion</a>
      </small>
      <small class="date">2020-08-19 00:00:00 &#43;0200 &#43;0200</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://sourcehut.org/blog/2020-08-16-whats-cooking-august-2020/" target="_blank" rel="noopener">What&#39;s cooking on Sourcehut? August 2020</a>
      </h4>
      <p class="summary">Another month passes and we find ourselves writing (or reading) this status
update on a quiet, rainy Sunday morning. Today our userbase numbers 16,683
members strong, up 580 from last month. Please extend a kind welcome to our new
colleagues! Thanks for read…</p>
      <small class="source">
        via <a href="https://sourcehut.org/blog/">Blogs on Sourcehut</a>
      </small>
      <small class="date">2020-08-16 00:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://blog.golang.org/go1.15" target="_blank" rel="noopener">Go 1.15 is released</a>
      </h4>
      <p class="summary">
  
  
    
      
        Today the Go team is very happy to announce the release of Go 1.15. You can get it from the download page.
Some of the highlights include:

Substantial improvements to the Go linker
Improved allocation for small objects at high core coun…</p>
      <small class="source">
        via <a href="https://blog.golang.org/feed.atom">The Go Programming Language Blog</a>
      </small>
      <small class="date">2020-08-11 11:00:00 &#43;0000 &#43;0000</small>
    </div>
    
    <div class="article">
      <h4 class="title">
        <a href="https://100r.co/site/north_pacific_logbook.html" target="_blank" rel="noopener">North Pacific Logbook</a>
      </h4>
      <p class="summary">
The passage from Japan (Shimoda) to Canada (Victoria) took 51 days, and it was the hardest thing we&#39;ve ever done. We decided to keep a logbook, to better remember it and so it can help others who wish to make this trip.Continue Reading
  </p>
      <small class="source">
        via <a href="https://100r.co/">Hundred Rabbits</a>
      </small>
      <small class="date">2020-07-31 00:00:00 &#43;0000 GMT</small>
    </div>
    
  </section>
</section>


<footer>
  The content for this site is
  <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
  The <a href="https://git.sr.ht/~sircmpwn/drewdevault.com">code for this site</a>
  is <a href="https://opensource.org/licenses/MIT">MIT</a>.
</footer>

